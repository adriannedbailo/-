<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí™ –°—É—á–∞—Å–Ω–∏–π —Ç—Ä–µ–∫–µ—Ä —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</title>
    <style>
        :root {
            /* Light theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --bg-glass: rgba(255, 255, 255, 0.8);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] {
            /* Dark theme */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-glass: rgba(30, 41, 59, 0.8);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --accent-primary: #818cf8;
            --accent-secondary: #a78bfa;
            --accent-gradient: linear-gradient(135deg, #818cf8 0%, #a78bfa 100%);
            --success: #34d399;
            --warning: #fbbf24;
            --danger: #f87171;
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.4);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            opacity: 0.02;
            pointer-events: none;
            z-index: -1;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 2rem 2rem 2rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 50px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            background: var(--accent-primary);
            color: white;
            transform: scale(1.1);
        }

        .progress-section {
            padding: 0 2rem;
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: var(--bg-tertiary);
            border-radius: 50px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 50px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .weeks-navigation {
            padding: 0 1rem;
        }

        .phase-group {
            margin-bottom: 2rem;
        }

        .phase-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-muted);
            padding: 0 1rem 0.5rem 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .week-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .week-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }

        .week-item.active {
            background: var(--accent-gradient);
            color: white;
            box-shadow: var(--shadow-medium);
        }

        .week-item.completed {
            background: var(--success);
            color: white;
        }

        .week-number {
            font-weight: 700;
            margin-right: 0.75rem;
            min-width: 2rem;
        }

        .week-info {
            flex: 1;
        }

        .week-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.125rem;
        }

        .week-subtitle {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .week-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-primary);
        }

        .week-item.completed .week-status {
            background: white;
        }

        /* Main content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            max-width: calc(100vw - 280px);
        }

        .content-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: var(--shadow-light);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Exercise cards */
        .exercises-grid {
            display: grid;
            gap: 2rem;
        }

        .exercise-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent-gradient);
        }

        .exercise-card.main-exercise::before {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .exercise-card.legs-exercise::before {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .exercise-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .exercise-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .exercise-icon {
            font-size: 1.5rem;
        }

        .exercise-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .exercise-description {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .exercise-meta {
            text-align: right;
        }

        .sets-reps {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .exercise-type {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        /* Collapsible calculator */
        .calculator-section {
            margin-bottom: 1.5rem;
        }

        .calculator-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculator-toggle:hover {
            background: var(--bg-tertiary);
        }

        .calculator-toggle.active {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            background: var(--accent-primary);
            color: white;
        }

        .toggle-text {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 0.875rem;
        }

        .calculator-toggle.active .toggle-icon {
            transform: rotate(180deg);
        }

        .calculator-content {
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 1.5rem;
            background: var(--bg-secondary);
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .calculator-content.open {
            max-height: 500px;
        }

        .calc-modes {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 0.25rem;
            margin-bottom: 1rem;
        }

        .calc-mode {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .calc-mode.active {
            background: white;
            color: var(--text-primary);
            box-shadow: var(--shadow-light);
        }

        [data-theme="dark"] .calc-mode.active {
            background: var(--bg-primary);
        }

        .calc-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .calc-input {
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-weight: 600;
            text-align: center;
            width: 80px;
            transition: all 0.3s ease;
        }

        .calc-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .calc-result {
            background: var(--accent-gradient);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            box-shadow: var(--shadow-light);
        }

        .percentage-badge {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Sets table */
        .sets-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: var(--bg-primary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .sets-table th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 1rem 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .sets-table td {
            padding: 0.75rem 0.5rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .sets-table tr:last-child td {
            border-bottom: none;
        }

        .warmup-row {
            background: var(--bg-secondary);
            color: var(--text-muted);
            font-style: italic;
        }

        .working-row {
            background: var(--bg-primary);
        }

        .working-row:hover {
            background: var(--bg-secondary);
        }

        .set-input {
            width: 60px;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            text-align: center;
            font-size: 0.875rem;
        }

        .set-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .set-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            background: var(--bg-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .set-checkbox.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .set-checkbox:hover {
            transform: scale(1.1);
        }

        /* Exercise stats */
        .exercise-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--accent-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                max-width: 100vw;
                padding: 1rem;
            }

            .mobile-menu-btn {
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 101;
                background: var(--accent-gradient);
                color: white;
                border: none;
                border-radius: 50%;
                width: 48px;
                height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: var(--shadow-medium);
            }

            .content-header {
                margin-top: 3rem;
            }

            .calc-row {
                flex-direction: column;
                align-items: stretch;
            }

            .sets-table {
                font-size: 0.8rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .exercise-card {
            animation: fadeInUp 0.5s ease forwards;
        }

        .exercise-card:nth-child(2) {
            animation-delay: 0.1s;
        }

        .exercise-card:nth-child(3) {
            animation-delay: 0.2s;
        }

        .exercise-card:nth-child(4) {
            animation-delay: 0.3s;
        }

        /* Save indicator */
        .save-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--success);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Mobile menu button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">
        ‚ò∞
    </button>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">üí™ Bench Beast</div>
                <div class="subtitle">12-—Ç–∏–∂–Ω–µ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ —Å–∏–ª–∏</div>
            </div>

            <button class="theme-toggle" onclick="toggleTheme()" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">
                üåô
            </button>

            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgress"></div>
                </div>
                <div class="progress-text" id="progressText">–¢–∏–∂–¥–µ–Ω—å 1 –∑ 12 ‚Ä¢ 0% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
            </div>

            <nav class="weeks-navigation">
                <div class="phase-group">
                    <div class="phase-title">–§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∏–π –æ–±'—î–º</div>
                    <div class="week-item active" onclick="loadWeek(1)">
                        <div class="week-number">1</div>
                        <div class="week-info">
                            <div class="week-title">–ë–∞–∑–æ–≤–∏–π —Å—Ç–∞—Ä—Ç</div>
                            <div class="week-subtitle">65% √ó 4√ó10</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(2)">
                        <div class="week-number">2</div>
                        <div class="week-info">
                            <div class="week-title">–ê–¥–∞–ø—Ç–∞—Ü—ñ—è</div>
                            <div class="week-subtitle">67% √ó 4√ó9</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(3)">
                        <div class="week-number">3</div>
                        <div class="week-info">
                            <div class="week-title">–ü—Ä–æ–≥—Ä–µ—Å—ñ—è</div>
                            <div class="week-subtitle">69% √ó 4√ó8</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(4)">
                        <div class="week-number">4</div>
                        <div class="week-info">
                            <div class="week-title">–ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è</div>
                            <div class="week-subtitle">70% √ó 4√ó8</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                </div>

                <div class="phase-group">
                    <div class="phase-title">–§–∞–∑–∞ 2: –†–æ–∑–≤–∏—Ç–æ–∫ —Å–∏–ª–∏</div>
                    <div class="week-item" onclick="loadWeek(5)">
                        <div class="week-number">5</div>
                        <div class="week-info">
                            <div class="week-title">–ü–æ—á–∞—Ç–æ–∫ —Å–∏–ª–∏</div>
                            <div class="week-subtitle">75% √ó 4√ó6</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(6)">
                        <div class="week-number">6</div>
                        <div class="week-info">
                            <div class="week-title">–ü'—è—Ç—ñ—Ä–∫–∏</div>
                            <div class="week-subtitle">77% √ó 5√ó5</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(7)">
                        <div class="week-number">7</div>
                        <div class="week-info">
                            <div class="week-title">–í–∞–∂–∫—ñ –ø'—è—Ç—ñ—Ä–∫–∏</div>
                            <div class="week-subtitle">80% √ó 5√ó5</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(8)">
                        <div class="week-number">8</div>
                        <div class="week-info">
                            <div class="week-title">–î–µ–ª–æ–∞–¥</div>
                            <div class="week-subtitle">75% √ó 4√ó6</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                </div>

                <div class="phase-group">
                    <div class="phase-title">–§–∞–∑–∞ 3: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Å–∏–ª–∞</div>
                    <div class="week-item" onclick="loadWeek(9)">
                        <div class="week-number">9</div>
                        <div class="week-info">
                            <div class="week-title">–ß–µ—Ç–≤—ñ—Ä–∫–∏</div>
                            <div class="week-subtitle">85% √ó 5√ó4</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(10)">
                        <div class="week-number">10</div>
                        <div class="week-info">
                            <div class="week-title">–¢—Ä—ñ–π–∫–∏</div>
                            <div class="week-subtitle">90% √ó 5√ó3</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(11)">
                        <div class="week-number">11</div>
                        <div class="week-info">
                            <div class="week-title">–í–∞–∂–∫—ñ —Ç—Ä—ñ–π–∫–∏</div>
                            <div class="week-subtitle">92% √ó 5√ó3</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                    <div class="week-item" onclick="loadWeek(12)">
                        <div class="week-number">12</div>
                        <div class="week-info">
                            <div class="week-title">–ü—ñ–∫ —Å–∏–ª–∏</div>
                            <div class="week-subtitle">95% √ó 3√ó2</div>
                        </div>
                        <div class="week-status"></div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <header class="content-header">
                <div>
                    <h1 class="page-title" id="pageTitle">–¢–∏–∂–¥–µ–Ω—å 1: –ë–∞–∑–æ–≤–∏–π —Å—Ç–∞—Ä—Ç</h1>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary btn-sm" onclick="exportData()">
                        üì• –ï–∫—Å–ø–æ—Ä—Ç
                    </button>
                    <label for="importFile" class="btn btn-secondary btn-sm">
                        üì§ –Ü–º–ø–æ—Ä—Ç
                    </label>
                    <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(event)">
                    <button class="btn btn-success" onclick="completeWeek()" id="completeWeekBtn">
                        ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ç–∏–∂–¥–µ–Ω—å
                    </button>
                </div>
            </header>

            <div class="exercises-grid" id="exercisesGrid">
                <!-- Exercise cards will be generated here -->
            </div>
        </main>
    </div>

    <div id="saveIndicator" class="save-indicator">‚úì –ó–±–µ—Ä–µ–∂–µ–Ω–æ</div>

    <script>
        let currentWeek = 1;
        let currentTheme = 'light';
        let programData = {};

        // Program structure remains the same
        const programStructure = {
            1: { phase: 1, percentage: 0.65, sets: 4, reps: 10, title: "–ë–∞–∑–æ–≤–∏–π —Å—Ç–∞—Ä—Ç" },
            2: { phase: 1, percentage: 0.67, sets: 4, reps: 9, title: "–ê–¥–∞–ø—Ç–∞—Ü—ñ—è" },
            3: { phase: 1, percentage: 0.69, sets: 4, reps: 8, title: "–ü—Ä–æ–≥—Ä–µ—Å—ñ—è" },
            4: { phase: 1, percentage: 0.70, sets: 4, reps: 8, title: "–ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è" },
            5: { phase: 2, percentage: 0.75, sets: 4, reps: 6, title: "–ü–æ—á–∞—Ç–æ–∫ —Å–∏–ª–∏" },
            6: { phase: 2, percentage: 0.77, sets: 5, reps: 5, title: "–ü'—è—Ç—ñ—Ä–∫–∏" },
            7: { phase: 2, percentage: 0.80, sets: 5, reps: 5, title: "–í–∞–∂–∫—ñ –ø'—è—Ç—ñ—Ä–∫–∏" },
            8: { phase: 2, percentage: 0.75, sets: 4, reps: 6, title: "–î–µ–ª–æ–∞–¥" },
            9: { phase: 3, percentage: 0.85, sets: 5, reps: 4, title: "–ß–µ—Ç–≤—ñ—Ä–∫–∏" },
            10: { phase: 3, percentage: 0.90, sets: 5, reps: 3, title: "–¢—Ä—ñ–π–∫–∏" },
            11: { phase: 3, percentage: 0.92, sets: 5, reps: 3, title: "–í–∞–∂–∫—ñ —Ç—Ä—ñ–π–∫–∏" },
            12: { phase: 3, percentage: 0.95, sets: 3, reps: 2, title: "–ü—ñ–∫ —Å–∏–ª–∏" }
        };

        // Updated exercise templates with clearer descriptions
        const exerciseTemplates = {
            1: [ // –î–µ–Ω—å 1: –ñ–∏–º + –ø—Ä–∏—Å—ñ–¥ + —Å–ø–∏–Ω–∞ + —Ç—Ä–∏—Ü–µ–ø—Å
                { 
                    id: 'bench', 
                    name: '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª–µ–∂–∞—á–∏', 
                    description: '–ö–ª–∞—Å–∏—á–Ω–∏–π –∂–∏–º –ª–µ–∂–∞—á–∏ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ–π –ª–∞–≤—ñ',
                    icon: 'üèãÔ∏è',
                    isMain: true, 
                    basePercentage: 1.0, 
                    type: 'main' 
                },
                { 
                    id: 'squat', 
                    name: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑—ñ —à—Ç–∞–Ω–≥–æ—é', 
                    description: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑—ñ —à—Ç–∞–Ω–≥–æ—é –Ω–∞ –ø–ª–µ—á–∞—Ö –¥–æ –ø–∞—Ä–∞–ª–µ–ª—ñ',
                    icon: 'ü¶µ',
                    isMain: true, 
                    basePercentage: 1.0, 
                    type: 'legs' 
                },
                { 
                    id: 'row', 
                    name: '–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞—Ö–∏–ª—ñ', 
                    description: '–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –¥–æ –ø–æ—è—Å—É –≤ –Ω–∞—Ö–∏–ª—ñ 45¬∞',
                    icon: 'üö£',
                    sets: 3, 
                    reps: 9, 
                    basePercentage: 0.90, 
                    type: 'back' 
                },
                { 
                    id: 'close_grip', 
                    name: '–í—É–∑—å–∫–∏–π –∂–∏–º –ª–µ–∂–∞—á–∏', 
                    description: '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –≤—É–∑—å–∫–∏–º —Ö–≤–∞—Ç–æ–º –¥–ª—è —Ç—Ä–∏—Ü–µ–ø—Å—ñ–≤',
                    icon: 'üí™',
                    sets: 3, 
                    reps: 10, 
                    basePercentage: 0.85, 
                    type: 'tricep' 
                }
            ],
            2: [ // –î–µ–Ω—å 2: –ü–ª–µ—á—ñ + —Å–ø–∏–Ω–∞
                { 
                    id: 'dumbbell_press', 
                    name: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å—Ç–æ—è—á–∏', 
                    description: '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞–¥ –≥–æ–ª–æ–≤–æ—é —Å—Ç–æ—è—á–∏',
                    icon: 'üèãÔ∏è',
                    sets: 4, 
                    reps: 7, 
                    basePercentage: 0.70, 
                    type: 'shoulders' 
                },
                { 
                    id: 'pulldown', 
                    name: '–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω—å–æ–≥–æ –±–ª–æ–∫—É', 
                    description: '–¢—è–≥–∞ –≤–µ—Ä—Ö–Ω—å–æ–≥–æ –±–ª–æ–∫—É –¥–æ –≥—Ä—É–¥–µ–π —à–∏—Ä–æ–∫–∏–º —Ö–≤–∞—Ç–æ–º',
                    icon: 'üö£',
                    sets: 3, 
                    reps: 9, 
                    basePercentage: 0.80, 
                    type: 'back' 
                },
                { 
                    id: 'lateral_raise', 
                    name: '–ú–∞—Ö–∏ –≥–∞–Ω—Ç–µ–ª—è–º–∏ –≤ —Å—Ç–æ—Ä–æ–Ω–∏', 
                    description: '–ü—ñ–¥–π–æ–º –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω–∏ —Å—Ç–æ—è—á–∏',
                    icon: 'üî•',
                    sets: 3, 
                    reps: 12, 
                    basePercentage: 0.50, 
                    type: 'shoulders' 
                },
                { 
                    id: 'face_pull', 
                    name: '–¢—è–≥–∞ –∫–∞–Ω–∞—Ç—É –¥–æ –æ–±–ª–∏—á—á—è', 
                    description: '–¢—è–≥–∞ –∫–∞–Ω–∞—Ç—É –¥–æ –æ–±–ª–∏—á—á—è –¥–ª—è –∑–∞–¥–Ω—ñ—Ö –¥–µ–ª—å—Ç',
                    icon: 'üéØ',
                    sets: 3, 
                    reps: 15, 
                    basePercentage: 0.45, 
                    type: 'shoulders' 
                }
            ],
            3: [ // –î–µ–Ω—å 3: –û–±'—î–º + –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è + –Ω–æ–≥–∏
                { 
                    id: 'volume_bench', 
                    name: "–ñ–∏–º –ª–µ–∂–∞—á–∏ (–æ–±'—î–º–Ω–∏–π)", 
                    description: '–ñ–∏–º –ª–µ–∂–∞—á–∏ –∑ –º–µ–Ω—à–æ—é –≤–∞–≥–æ—é –¥–ª—è –æ–±\'—î–º—É',
                    icon: 'üèãÔ∏è',
                    sets: 3, 
                    reps: 10, 
                    basePercentage: 0.75, 
                    type: 'main' 
                },
                { 
                    id: 'romanian_deadlift', 
                    name: '–†—É–º—É–Ω—Å—å–∫–∞ —Ç—è–≥–∞', 
                    description: '–†—É–º—É–Ω—Å—å–∫–∞ —Ç—è–≥–∞ –∑—ñ —à—Ç–∞–Ω–≥–æ—é –¥–ª—è –∑–∞–¥–Ω—å–æ—ó –ø–æ–≤–µ—Ä—Ö–Ω—ñ',
                    icon: 'ü¶µ',
                    sets: 3, 
                    reps: 8, 
                    basePercentage: 0.80, 
                    type: 'legs' 
                },
                { 
                    id: 'calf_raise', 
                    name: '–ü—ñ–¥–π–æ–º –Ω–∞ –Ω–æ—Å–∫–∏', 
                    description: '–ü—ñ–¥–π–æ–º –Ω–∞ –Ω–æ—Å–∫–∏ —Å—Ç–æ—è—á–∏ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ñ',
                    icon: 'ü¶µ',
                    sets: 4, 
                    reps: 15, 
                    basePercentage: 0.75, 
                    type: 'legs' 
                },
                { 
                    id: 'dumbbell_row', 
                    name: '–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª—ñ –æ–¥–Ω—ñ—î—é —Ä—É–∫–æ—é', 
                    description: '–¢—è–≥–∞ –≥–∞–Ω—Ç–µ–ª—ñ –≤ –Ω–∞—Ö–∏–ª—ñ –∑ –æ–ø–æ—Ä–æ—é –Ω–∞ –ª–∞–≤—É',
                    icon: 'üö£',
                    sets: 3, 
                    reps: 10, 
                    basePercentage: 0.75, 
                    type: 'back' 
                },
                { 
                    id: 'tricep_ext', 
                    name: '–†–æ–∑–≥–∏–Ω–∞–Ω–Ω—è —Ä—É–∫ –Ω–∞ –±–ª–æ—Ü—ñ', 
                    description: '–†–æ–∑–≥–∏–Ω–∞–Ω–Ω—è —Ä—É–∫ –Ω–∞ –≤–µ—Ä—Ö–Ω—å–æ–º—É –±–ª–æ—Ü—ñ',
                    icon: 'üí™',
                    sets: 3, 
                    reps: 12, 
                    basePercentage: 0.65, 
                    type: 'tricep' 
                },
                { 
                    id: 'bicep_curl', 
                    name: '–ó–≥–∏–Ω–∞–Ω–Ω—è –Ω–∞ –±—ñ—Ü–µ–ø—Å', 
                    description: '–ó–≥–∏–Ω–∞–Ω–Ω—è —Ä—É–∫ –∑ –≥–∞–Ω—Ç–µ–ª—è–º–∏ —Å—Ç–æ—è—á–∏',
                    icon: 'üí™',
                    sets: 3, 
                    reps: 12, 
                    basePercentage: 0.60, 
                    type: 'bicep' 
                }
            ]
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadProgramData();
            loadWeek(currentWeek);
            updateMobileMenu();
        });

        function loadProgramData() {
            const saved = localStorage.getItem('benchPressTrackerModern');
            if (saved) {
                try {
                    programData = JSON.parse(saved);
                    currentWeek = programData.currentWeek || 1;
                } catch (e) {
                    console.error('Error loading data:', e);
                    initializeProgramData();
                }
            } else {
                initializeProgramData();
            }
        }

        function initializeProgramData() {
            programData = {
                currentWeek: 1,
                weeks: {}
            };

            for (let week = 1; week <= 12; week++) {
                programData.weeks[week] = {
                    completed: false,
                    days: {}
                };

                for (let day = 1; day <= 3; day++) {
                    programData.weeks[week].days[day] = {
                        completed: false,
                        exercises: {}
                    };

                    exerciseTemplates[day].forEach(exercise => {
                        programData.weeks[week].days[day].exercises[exercise.id] = {
                            oneRepMax: 0,
                            workingWeight: 0,
                            sets: {}
                        };
                    });
                }
            }
            saveProgramData();
        }

        function saveProgramData() {
            try {
                localStorage.setItem('benchPressTrackerModern', JSON.stringify(programData));
                showSaveIndicator();
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            const themeBtn = document.querySelector('.theme-toggle');
            themeBtn.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            
            localStorage.setItem('theme', currentTheme);
        }

        function loadWeek(weekNum) {
            currentWeek = weekNum;
            programData.currentWeek = currentWeek;
            saveProgramData();
            
            updateSidebarWeeks();
            displayWeek(weekNum);
            updateProgress();
        }

        function updateSidebarWeeks() {
            const weekItems = document.querySelectorAll('.week-item');
            weekItems.forEach((item, index) => {
                const weekNumber = index + 1;
                item.classList.remove('active', 'completed');
                
                if (weekNumber === currentWeek) {
                    item.classList.add('active');
                } else if (programData.weeks[weekNumber]?.completed) {
                    item.classList.add('completed');
                }
            });
        }

        function displayWeek(weekNum) {
            const weekData = programStructure[weekNum];
            const pageTitle = document.getElementById('pageTitle');
            pageTitle.textContent = `–¢–∏–∂–¥–µ–Ω—å ${weekNum}: ${weekData.title}`;

            const grid = document.getElementById('exercisesGrid');
            grid.innerHTML = '';

            // Generate exercise cards for all 3 days
            for (let day = 1; day <= 3; day++) {
                const dayTitle = getDayTitle(day);
                const dayHeader = document.createElement('h2');
                dayHeader.style.cssText = `
                    margin: 2rem 0 1rem 0;
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    border-bottom: 2px solid var(--border-color);
                    padding-bottom: 0.5rem;
                `;
                dayHeader.textContent = dayTitle;
                grid.appendChild(dayHeader);

                exerciseTemplates[day].forEach(exercise => {
                    const card = createExerciseCard(weekNum, day, exercise);
                    grid.appendChild(card);
                });
            }
        }

        function getDayTitle(day) {
            const titles = {
                1: 'üî• –î–µ–Ω—å 1: –ñ–∏–º + –ü—Ä–∏—Å—ñ–¥ + –°–ø–∏–Ω–∞ + –¢—Ä–∏—Ü–µ–ø—Å',
                2: 'üí™ –î–µ–Ω—å 2: –ü–ª–µ—á—ñ + –°–ø–∏–Ω–∞',
                3: 'üîÑ –î–µ–Ω—å 3: –û–±\'—î–º + –ù–æ–≥–∏ + –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è'
            };
            return titles[day];
        }

        function createExerciseCard(weekNum, dayNum, exercise) {
            const weekData = programStructure[weekNum];
            const exerciseData = programData.weeks[weekNum]?.days[dayNum]?.exercises[exercise.id] || {};
            
            const sets = exercise.isMain ? weekData.sets : (exercise.sets || 3);
            const reps = exercise.isMain ? weekData.reps : (exercise.reps || 10);
            const weekPercentage = exercise.isMain ? weekData.percentage : (weekData.percentage * exercise.basePercentage);
            const displayPercentage = Math.round(weekPercentage * 100);

            const card = document.createElement('div');
            card.className = `exercise-card ${exercise.type}-exercise`;
            
            const cardId = `card-${weekNum}-${dayNum}-${exercise.id}`;
            card.id = cardId;

            card.innerHTML = `
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon">${exercise.icon}</div>
                        <div>
                            <div class="exercise-name">${exercise.name}</div>
                            <div class="exercise-description">${exercise.description}</div>
                        </div>
                    </div>
                    <div class="exercise-meta">
                        <div class="sets-reps">${sets}√ó${reps}</div>
                        <div class="exercise-type">${getExerciseTypeName(exercise.type)}</div>
                    </div>
                </div>

                <div class="calculator-section">
                    <div class="calculator-toggle" onclick="toggleCalculator('${cardId}')">
                        <div class="toggle-text">
                            <span>‚öñÔ∏è</span>
                            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–∞–≥–∏ (${displayPercentage}%)</span>
                        </div>
                        <div class="toggle-icon">‚ñº</div>
                    </div>
                    <div class="calculator-content" id="calc-${cardId}">
                        <div class="calc-modes">
                            <button class="calc-mode active" onclick="switchCalcMode('${cardId}', 'direct')">
                                –í–≤–µ—Å—Ç–∏ 1–ü–ú
                            </button>
                            <button class="calc-mode" onclick="switchCalcMode('${cardId}', 'calculate')">
                                –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ 1–ü–ú
                            </button>
                        </div>
                        
                        <div id="direct-${cardId}">
                            <div class="calc-row">
                                <span style="font-weight: 600;">1–ü–ú:</span>
                                <input type="number" class="calc-input" 
                                       id="oneRM-${cardId}" 
                                       value="${exerciseData.oneRepMax || ''}"
                                       placeholder="–∫–≥"
                                       onchange="calculate1RMDirect('${cardId}', ${weekPercentage})">
                                <span>‚Üí</span>
                                <div class="calc-result" id="result-${cardId}">
                                    ${exerciseData.workingWeight || 0} –∫–≥
                                </div>
                                <div class="percentage-badge">${displayPercentage}%</div>
                            </div>
                        </div>

                        <div id="calculate-${cardId}" class="hidden">
                            <div class="calc-row">
                                <span style="font-weight: 600;">–ú–∞–∫—Å–∏–º—É–º:</span>
                                <input type="number" class="calc-input" 
                                       id="maxWeight-${cardId}" 
                                       placeholder="–í–∞–≥–∞">
                                <span>–∫–≥ –Ω–∞</span>
                                <input type="number" class="calc-input" 
                                       id="maxReps-${cardId}" 
                                       placeholder="–ü–æ–≤—Ç–æ—Ä–∏">
                                <span>–ø–æ–≤—Ç–æ—Ä—ñ–≤</span>
                                <button class="btn btn-primary btn-sm" onclick="calculate1RMFromReps('${cardId}', ${weekPercentage})">
                                    –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏
                                </button>
                            </div>
                        </div>

                        <div style="margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap;">
                            <button class="btn btn-primary btn-sm" onclick="autoFillExercise('${cardId}', ${sets}, ${reps})">
                                ü§ñ –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                            </button>
                            ${weekNum > 1 ? `
                                <button class="btn btn-secondary btn-sm" onclick="autoProgressWeight('${cardId}', ${weekPercentage})">
                                    üöÄ –ü—Ä–æ–≥—Ä–µ—Å—ñ—è
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <table class="sets-table" id="setsTable-${cardId}">
                    <thead>
                        <tr>
                            <th>–ü—ñ–¥—Ö—ñ–¥</th>
                            <th>–í–∞–≥–∞ (–∫–≥)</th>
                            <th>–ü–æ–≤—Ç–æ—Ä–∏</th>
                            <th>RPE</th>
                            <th>‚úì</th>
                        </tr>
                    </thead>
                    <tbody id="setsBody-${cardId}">
                        <!-- Sets will be generated here -->
                    </tbody>
                </table>

                <div class="exercise-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="completedSets-${cardId}">0</div>
                        <div class="stat-label">–ü—ñ–¥—Ö–æ–¥–∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalReps-${cardId}">0</div>
                        <div class="stat-label">–ü–æ–≤—Ç–æ—Ä–∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalVolume-${cardId}">0</div>
                        <div class="stat-label">–û–±'—î–º (–∫–≥)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgRPE-${cardId}">0</div>
                        <div class="stat-label">–°–µ—Ä. RPE</div>
                    </div>
                </div>
            `;

            // Generate sets table after a short delay
            setTimeout(() => {
                generateSetsTable(cardId, sets, reps);
                updateExerciseStats(cardId);
            }, 100);

            return card;
        }

        function getExerciseTypeName(type) {
            const names = {
                'main': '–û—Å–Ω–æ–≤–Ω–∞',
                'legs': '–ù–æ–≥–∏',
                'back': '–°–ø–∏–Ω–∞',
                'shoulders': '–ü–ª–µ—á—ñ',
                'tricep': '–¢—Ä–∏—Ü–µ–ø—Å',
                'bicep': '–ë—ñ—Ü–µ–ø—Å'
            };
            return names[type] || '–î–æ–ø–æ–º—ñ–∂–Ω–∞';
        }

        function toggleCalculator(cardId) {
            const toggle = document.querySelector(`#${cardId} .calculator-toggle`);
            const content = document.getElementById(`calc-${cardId}`);
            
            toggle.classList.toggle('active');
            content.classList.toggle('open');
        }

        function switchCalcMode(cardId, mode) {
            const directBtn = document.querySelector(`#${cardId} .calc-mode:first-child`);
            const calculateBtn = document.querySelector(`#${cardId} .calc-mode:last-child`);
            const directDiv = document.getElementById(`direct-${cardId}`);
            const calculateDiv = document.getElementById(`calculate-${cardId}`);

            if (mode === 'direct') {
                directBtn.classList.add('active');
                calculateBtn.classList.remove('active');
                directDiv.classList.remove('hidden');
                calculateDiv.classList.add('hidden');
            } else {
                directBtn.classList.remove('active');
                calculateBtn.classList.add('active');
                directDiv.classList.add('hidden');
                calculateDiv.classList.remove('hidden');
            }
        }

        function calculate1RMDirect(cardId, weekPercentage) {
            const oneRMInput = document.getElementById(`oneRM-${cardId}`);
            const oneRepMax = parseFloat(oneRMInput.value);
            
            if (!oneRepMax || oneRepMax <= 0) {
                const resultElement = document.getElementById(`result-${cardId}`);
                resultElement.textContent = '0 –∫–≥';
                return;
            }

            const workingWeight = Math.round(oneRepMax * weekPercentage / 2.5) * 2.5;
            const resultElement = document.getElementById(`result-${cardId}`);
            resultElement.textContent = `${workingWeight} –∫–≥`;

            // Save to program data
            saveExerciseData(cardId, { oneRepMax, workingWeight });
        }

        function calculate1RMFromReps(cardId, weekPercentage) {
            const weightInput = document.getElementById(`maxWeight-${cardId}`);
            const repsInput = document.getElementById(`maxReps-${cardId}`);
            
            const maxWeight = parseFloat(weightInput.value);
            const maxReps = parseInt(repsInput.value);

            if (!maxWeight || !maxReps || maxWeight <= 0 || maxReps <= 0) {
                alert('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ: –≤–∞–≥—É —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å');
                return;
            }

            const oneRepMax = Math.round(maxWeight * (1 + maxReps / 30) * 2) / 2;
            const workingWeight = Math.round(oneRepMax * weekPercentage / 2.5) * 2.5;

            document.getElementById(`oneRM-${cardId}`).value = oneRepMax;
            document.getElementById(`result-${cardId}`).textContent = `${workingWeight} –∫–≥`;

            saveExerciseData(cardId, { oneRepMax, workingWeight });
            alert(`1–ü–ú —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ: ${oneRepMax}–∫–≥ ‚Üí –†–æ–±–æ—á–∞ –≤–∞–≥–∞: ${workingWeight}–∫–≥`);
        }

        function saveExerciseData(cardId, data) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            
            if (!programData.weeks[weekNum]) programData.weeks[weekNum] = { days: {} };
            if (!programData.weeks[weekNum].days[dayNum]) programData.weeks[weekNum].days[dayNum] = { exercises: {} };
            if (!programData.weeks[weekNum].days[dayNum].exercises[exerciseId]) {
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId] = { sets: {} };
            }

            Object.assign(programData.weeks[weekNum].days[dayNum].exercises[exerciseId], data);
            saveProgramData();
        }

        function generateSetsTable(cardId, totalSets, targetReps) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const exerciseData = programData.weeks[weekNum]?.days[dayNum]?.exercises[exerciseId] || {};
            const workingWeight = exerciseData.workingWeight || 0;
            
            const warmupSets = generateWarmupSets(workingWeight);
            const workingSets = Array.from({length: totalSets}, (_, i) => ({
                weight: workingWeight,
                reps: targetReps,
                isWarmup: false,
                setNumber: i + 1
            }));
            
            const allSets = [...warmupSets, ...workingSets];
            const tbody = document.getElementById(`setsBody-${cardId}`);
            
            if (tbody) {
                tbody.innerHTML = allSets.map((set, index) => 
                    generateSetRow(cardId, set, index + 1)
                ).join('');
            }
        }

        function generateWarmupSets(workingWeight) {
            if (workingWeight <= 0) return [];
            
            let warmupSets = [];
            
            if (workingWeight < 60) {
                warmupSets = [
                    { percentage: 0.40, reps: 10 },
                    { percentage: 0.70, reps: 6 }
                ];
            } else if (workingWeight <= 100) {
                warmupSets = [
                    { percentage: 0.40, reps: 10 },
                    { percentage: 0.60, reps: 8 },
                    { percentage: 0.80, reps: 3 }
                ];
            } else if (workingWeight <= 150) {
                warmupSets = [
                    { percentage: 0.30, reps: 10 },
                    { percentage: 0.50, reps: 8 },
                    { percentage: 0.70, reps: 5 },
                    { percentage: 0.85, reps: 2 }
                ];
            } else {
                warmupSets = [
                    { percentage: 0.25, reps: 10 },
                    { percentage: 0.40, reps: 8 },
                    { percentage: 0.60, reps: 6 },
                    { percentage: 0.75, reps: 3 },
                    { percentage: 0.85, reps: 2 }
                ];
            }
            
            return warmupSets.map((set, index) => ({
                weight: Math.round(workingWeight * set.percentage / 2.5) * 2.5,
                reps: set.reps,
                isWarmup: true,
                setNumber: `–†${index + 1}`
            }));
        }

        function generateSetRow(cardId, setData, rowIndex) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const savedSetData = programData.weeks[weekNum]?.days[dayNum]?.exercises[exerciseId]?.sets[rowIndex] || {};
            const isCompleted = savedSetData.completed || false;
            const rowClass = setData.isWarmup ? 'warmup-row' : 'working-row';
            
            return `
                <tr class="${rowClass}" ${isCompleted ? 'style="background: var(--success); color: white;"' : ''}>
                    <td><strong>${setData.setNumber}</strong></td>
                    <td>
                        <input type="number" class="set-input" 
                               id="weight-${cardId}-${rowIndex}"
                               placeholder="${setData.weight || '–∫–≥'}" 
                               value="${savedSetData.weight || (setData.isWarmup ? setData.weight : '')}"
                               onchange="updateSetData('${cardId}', ${rowIndex})">
                    </td>
                    <td>
                        <input type="number" class="set-input" 
                               id="reps-${cardId}-${rowIndex}"
                               placeholder="${setData.reps}" 
                               value="${savedSetData.reps || ''}"
                               onchange="updateSetData('${cardId}', ${rowIndex})">
                    </td>
                    <td>
                        <input type="number" class="set-input" 
                               id="rpe-${cardId}-${rowIndex}"
                               placeholder="RPE" 
                               min="1" max="10"
                               value="${savedSetData.rpe || ''}"
                               onchange="updateSetData('${cardId}', ${rowIndex})">
                    </td>
                    <td>
                        <div class="set-checkbox ${isCompleted ? 'completed' : ''}" 
                             onclick="toggleSet('${cardId}', ${rowIndex})">
                            ${isCompleted ? '‚úì' : ''}
                        </div>
                    </td>
                </tr>
            `;
        }

        function updateSetData(cardId, setNum) {
            const weightInput = document.getElementById(`weight-${cardId}-${setNum}`);
            const repsInput = document.getElementById(`reps-${cardId}-${setNum}`);
            const rpeInput = document.getElementById(`rpe-${cardId}-${setNum}`);

            const weight = parseFloat(weightInput?.value) || 0;
            const reps = parseInt(repsInput?.value) || 0;
            const rpe = parseInt(rpeInput?.value) || 0;

            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            
            if (!programData.weeks[weekNum]) programData.weeks[weekNum] = { days: {} };
            if (!programData.weeks[weekNum].days[dayNum]) programData.weeks[weekNum].days[dayNum] = { exercises: {} };
            if (!programData.weeks[weekNum].days[dayNum].exercises[exerciseId]) {
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId] = { sets: {} };
            }
            if (!programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum]) {
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum] = {};
            }

            const setData = programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum];
            setData.weight = weight;
            setData.reps = reps;
            setData.rpe = rpe;

            saveProgramData();
            updateExerciseStats(cardId);
        }

        function toggleSet(cardId, setNum) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            
            if (!programData.weeks[weekNum]?.days[dayNum]?.exercises[exerciseId]?.sets[setNum]) {
                return;
            }

            const setData = programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum];
            setData.completed = !setData.completed;

            // Update UI
            const row = document.querySelector(`#setsBody-${cardId} tr:nth-child(${setNum})`);
            const checkbox = row.querySelector('.set-checkbox');
            
            if (setData.completed) {
                row.style.background = 'var(--success)';
                row.style.color = 'white';
                checkbox.classList.add('completed');
                checkbox.textContent = '‚úì';
            } else {
                row.style.background = '';
                row.style.color = '';
                checkbox.classList.remove('completed');
                checkbox.textContent = '';
            }

            saveProgramData();
            updateExerciseStats(cardId);
        }

        function updateExerciseStats(cardId) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const exerciseData = programData.weeks[weekNum]?.days[dayNum]?.exercises[exerciseId];
            if (!exerciseData || !exerciseData.sets) return;

            const sets = Object.values(exerciseData.sets);
            const completedSets = sets.filter(set => set.completed);
            
            const totalReps = completedSets.reduce((sum, set) => sum + (set.reps || 0), 0);
            const totalVolume = completedSets.reduce((sum, set) => sum + ((set.weight || 0) * (set.reps || 0)), 0);
            const avgRPE = completedSets.length > 0 ? 
                completedSets.reduce((sum, set) => sum + (set.rpe || 0), 0) / completedSets.length : 0;

            const completedEl = document.getElementById(`completedSets-${cardId}`);
            const repsEl = document.getElementById(`totalReps-${cardId}`);
            const volumeEl = document.getElementById(`totalVolume-${cardId}`);
            const rpeEl = document.getElementById(`avgRPE-${cardId}`);

            if (completedEl) completedEl.textContent = completedSets.length;
            if (repsEl) repsEl.textContent = totalReps;
            if (volumeEl) volumeEl.textContent = totalVolume;
            if (rpeEl) rpeEl.textContent = avgRPE > 0 ? avgRPE.toFixed(1) : '0';
        }

        function autoFillExercise(cardId, totalSets, targetReps) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const exerciseData = programData.weeks[weekNum]?.days[dayNum]?.exercises[exerciseId] || {};
            const workingWeight = exerciseData.workingWeight || 0;
            
            if (workingWeight <= 0) {
                alert('–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å 1–ü–ú –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ä–æ–±–æ—á–æ—ó –≤–∞–≥–∏!');
                return;
            }

            if (parseInt(weekNum) === 1) {
                fillWithWorkingWeight(cardId, totalSets, targetReps, workingWeight);
            } else {
                copyFromPreviousWeek(cardId, totalSets, targetReps, workingWeight);
            }
            
            generateSetsTable(cardId, totalSets, targetReps);
            updateExerciseStats(cardId);
        }

        function fillWithWorkingWeight(cardId, totalSets, targetReps, workingWeight) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            
            if (!programData.weeks[weekNum]) programData.weeks[weekNum] = { days: {} };
            if (!programData.weeks[weekNum].days[dayNum]) programData.weeks[weekNum].days[dayNum] = { exercises: {} };
            if (!programData.weeks[weekNum].days[dayNum].exercises[exerciseId]) {
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId] = { sets: {} };
            }

            const warmupSets = generateWarmupSets(workingWeight);
            
            // Fill warmup sets
            warmupSets.forEach((warmupSet, index) => {
                const setNum = index + 1;
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum] = {
                    weight: warmupSet.weight,
                    reps: warmupSet.reps,
                    rpe: 6,
                    completed: false
                };
            });
            
            // Fill working sets
            for (let i = 0; i < totalSets; i++) {
                const setNum = warmupSets.length + i + 1;
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum] = {
                    weight: workingWeight,
                    reps: targetReps,
                    rpe: 8,
                    completed: false
                };
            }
            
            saveProgramData();
            alert(`–ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! ${warmupSets.length} —Ä–æ–∑–º–∏–Ω–æ—á–Ω–∏—Ö + ${totalSets} —Ä–æ–±–æ—á–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤.`);
        }

        function copyFromPreviousWeek(cardId, totalSets, targetReps, workingWeight) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const prevWeek = parseInt(weekNum) - 1;
            const prevExerciseData = programData.weeks[prevWeek]?.days[dayNum]?.exercises[exerciseId];
            
            if (!prevExerciseData || !prevExerciseData.sets) {
                fillWithWorkingWeight(cardId, totalSets, targetReps, workingWeight);
                return;
            }

            const prevSets = Object.values(prevExerciseData.sets).filter(set => set.completed);
            let progressionMultiplier = 1.0;
            
            if (prevSets.length > 0) {
                const avgRPE = prevSets.reduce((sum, set) => sum + (set.rpe || 8), 0) / prevSets.length;
                const allSetsCompleted = prevSets.length >= totalSets;
                
                if (avgRPE < 7 && allSetsCompleted) {
                    progressionMultiplier = 1.05;
                } else if (avgRPE <= 8 && allSetsCompleted) {
                    progressionMultiplier = 1.02;
                }
            }

            if (!programData.weeks[weekNum]) programData.weeks[weekNum] = { days: {} };
            if (!programData.weeks[weekNum].days[dayNum]) programData.weeks[weekNum].days[dayNum] = { exercises: {} };
            if (!programData.weeks[weekNum].days[dayNum].exercises[exerciseId]) {
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId] = { sets: {} };
            }

            const warmupSets = generateWarmupSets(workingWeight);
            
            // Fill warmup sets
            warmupSets.forEach((warmupSet, index) => {
                const setNum = index + 1;
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum] = {
                    weight: warmupSet.weight,
                    reps: warmupSet.reps,
                    rpe: 6,
                    completed: false
                };
            });
            
            // Fill working sets with progression
            for (let i = 0; i < totalSets; i++) {
                const setNum = warmupSets.length + i + 1;
                const adjustedWeight = Math.round(workingWeight * progressionMultiplier / 2.5) * 2.5;
                
                programData.weeks[weekNum].days[dayNum].exercises[exerciseId].sets[setNum] = {
                    weight: adjustedWeight,
                    reps: targetReps,
                    rpe: 8,
                    completed: false
                };
            }
            
            saveProgramData();
            
            const message = progressionMultiplier > 1.0 ? 
                `–ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑ –ø—Ä–æ–≥—Ä–µ—Å—ñ—î—é! –í–∞–≥–∞ –∑–±—ñ–ª—å—à–µ–Ω–∞ –Ω–∞ ${Math.round((progressionMultiplier - 1) * 100)}%` :
                `–ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í–∞–≥–∞ –±–µ–∑ –∑–º—ñ–Ω —á–µ—Ä–µ–∑ –≤–∏—Å–æ–∫–µ RPE.`;
            alert(message);
        }

        function autoProgressWeight(cardId, weekPercentage) {
            const [, weekNum, dayNum, exerciseId] = cardId.split('-');
            const prevWeek = parseInt(weekNum) - 1;
            
            if (prevWeek < 1) return;

            const prevExerciseData = programData.weeks[prevWeek]?.days[dayNum]?.exercises[exerciseId];
            if (!prevExerciseData || !prevExerciseData.sets) {
                alert('–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –∑ –º–∏–Ω—É–ª–æ–≥–æ —Ç–∏–∂–Ω—è –¥–ª—è —Ü—ñ—î—ó –≤–ø—Ä–∞–≤–∏');
                return;
            }

            const sets = Object.values(prevExerciseData.sets).filter(set => set.completed);
            if (sets.length === 0) {
                alert('–ù–µ–º–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤ –∑ –º–∏–Ω—É–ª–æ–≥–æ —Ç–∏–∂–Ω—è');
                return;
            }

            const avgRPE = sets.reduce((sum, set) => sum + (set.rpe || 8), 0) / sets.length;
            const allSetsCompleted = sets.length >= 3;

            let progressionMultiplier = 1;

            if (avgRPE < 7 && allSetsCompleted) {
                progressionMultiplier = 1.06;
            } else if (avgRPE <= 8 && allSetsCompleted) {
                progressionMultiplier = 1.03;
            }

            const newOneRepMax = Math.round(prevExerciseData.oneRepMax * progressionMultiplier * 2) / 2;
            const newWorkingWeight = Math.round(newOneRepMax * weekPercentage / 2.5) * 2.5;
            
            document.getElementById(`oneRM-${cardId}`).value = newOneRepMax;
            document.getElementById(`result-${cardId}`).textContent = `${newWorkingWeight} –∫–≥`;

            saveExerciseData(cardId, { oneRepMax: newOneRepMax, workingWeight: newWorkingWeight });
            
            const message = progressionMultiplier > 1 ? 
                `–ü—Ä–æ–≥—Ä–µ—Å! –ù–æ–≤–∏–π 1–ü–ú: ${newOneRepMax}–∫–≥ ‚Üí ${newWorkingWeight}–∫–≥` :
                `1–ü–ú –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è: ${newOneRepMax}–∫–≥ (RPE ${avgRPE.toFixed(1)})`;
            alert(message);
        }

        function completeWeek() {
            if (confirm(`–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ç–∏–∂–¥–µ–Ω—å ${currentWeek}?`)) {
                programData.weeks[currentWeek].completed = true;
                saveProgramData();
                updateSidebarWeeks();
                updateProgress();
                
                if (currentWeek < 12) {
                    setTimeout(() => {
                        loadWeek(currentWeek + 1);
                        alert(`–¢–∏–∂–¥–µ–Ω—å ${currentWeek - 1} –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ç–∏–∂–Ω—è ${currentWeek}.`);
                    }, 500);
                } else {
                    alert('–í—ñ—Ç–∞—î–º–æ! –í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å—é –ø—Ä–æ–≥—Ä–∞–º—É! üéâ');
                }
            }
        }

        function updateProgress() {
            const completedWeeks = Object.values(programData.weeks || {}).filter(week => week.completed).length;
            const progressPercent = (completedWeeks / 12) * 100;
            
            const progressEl = document.getElementById('overallProgress');
            const textEl = document.getElementById('progressText');
            
            if (progressEl) progressEl.style.width = `${progressPercent}%`;
            if (textEl) textEl.textContent = `–¢–∏–∂–¥–µ–Ω—å ${currentWeek} –∑ 12 ‚Ä¢ ${Math.round(progressPercent)}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ`;
        }

        function exportData() {
            const dataStr = JSON.stringify(programData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `bench-tracker-modern-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('–î–∞–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ? –¶–µ –∑–∞–º—ñ–Ω–∏—Ç—å –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ.')) {
                        programData = importedData;
                        currentWeek = programData.currentWeek || 1;
                        saveProgramData();
                        loadWeek(currentWeek);
                        alert('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!');
                    }
                } catch (error) {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ —Ñ–∞–π–ª—É.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        function updateMobileMenu() {
            const mobileBtn = document.querySelector('.mobile-menu-btn');
            if (window.innerWidth <= 768) {
                mobileBtn.style.display = 'flex';
            } else {
                mobileBtn.style.display = 'none';
            }
        }

        // Load saved theme
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
            
            const themeBtn = document.querySelector('.theme-toggle');
            themeBtn.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        });

        // Mobile responsiveness
        window.addEventListener('resize', updateMobileMenu);

        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const mobileBtn = document.querySelector('.mobile-menu-btn');
                
                if (!sidebar.contains(e.target) && !mobileBtn.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            }
        });
    </script>
</body>
</html>
